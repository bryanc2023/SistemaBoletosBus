<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="pasajero/layout :: head">

</head>

<body>
	<script src="https://www.paypal.com/sdk/js?client-id=AXfF6G_0CeXMq-WDLrXu2KxHNbxucKcNHKfY6-tAyJ1W9H0adlSONwT7MwXOLXm8bJiQQ-fcdlKkgZ_C&currency=USD"></script>
	<link rel="stylesheet" th:href="@{/css/pasajero/listarseleccion.css}" />
	<header th:replace="pasajero/layout :: header"></header>
	<div th:each="dato: ${datos}">
    <!-- Incluir un input oculto con el valor de dato[6] -->
    <input type="hidden" id="cronoValue" th:value="${dato[6]}"/>
	</div>
<script th:inline="javascript">
	var costo = /*[[${costo3}]]*/ 0; 
	var crono = document.getElementById('cronoValue').value;
    paypal.Buttons({
    createOrder: function(data, actions) {
        return actions.order.create({
            // ...
            purchase_units: [{
                amount: {
                    value: costo
                }
            }],
        });
    },
    onApprove: function(data, actions) {
         var asientosSeleccionados = obtenerAsientosSeleccionados2();

            // Redirigir a la URL del controlador con los parámetros necesarios
            window.location.href = '/asientos/guardarReserva2/' + crono + '/' + costo + '?idsAsientosSeleccionados=' + encodeURIComponent(asientosSeleccionados);
    }
}).render('#paypal-button-container'); 

 function obtenerAsientosSeleccionados2() {
        var asientosSeleccionados = [];
        var filasAsientos = document.querySelectorAll("tbody tr");

        filasAsientos.forEach(function(fila) {
            var idAsiento = fila.getAttribute("data-id");
            asientosSeleccionados.push(idAsiento);
        });

        // Asignar los IDs de los asientos al campo oculto
        document.getElementById("idsAsientosSeleccionados2").value = asientosSeleccionados.join(',');

        return asientosSeleccionados.join(',');
    }
    </script>
    <input type="hidden" id="idsAsientosSeleccionados2" name="idsAsientosSeleccionados2" />
	<div class="uni">
		<h1>Confirmar selección:</h1>
	</div>
	<div class="m-3"></div>
	<div class="container py-4">
		<div id="seleccion" class="card bg-light">
			<div id="ast" class="card-header"> Asientos seleccionados:</div>
			<div id="tar" class="card-body d-flex justify-content-between align-items-center">

				<div class="vista">
					<p>Usted ha seleccionado el/los siguientes asientos:</p>
					<table class="table table-dark table-hover">
						<thead class="thead-inverse">
							<tr>
								<th class="bg-dark text-white">F I L A</th>
								<th class="bg-dark text-white">C O L U M N A</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="asiento: ${asientos}" th:data-id="${asiento.id}">
								<td th:text="${asiento.fila}"></td>
								<td th:text="${asiento.columna}"></td>
							</tr>
						</tbody>
					</table>
					<span>Cada número y fila se encuentran anotados en la unidad seleccionada, favor de prestar
						atención si son los asientos a reservar.</span>
				</div>

				<img th:src="@{/images/pasajero/img6r.png}" width="500px" height="200px">

			</div>
		</div>
	</div>

	<div class="infor">
		<div class="row">
			<div class="col-sm-6">
				<div class="card" style="max-width: 450px; max-height: 450px; overflow: auto;">
					<div class="card-body">
						<h5 class="card-title">COSTO:</h5>
						<div class="is">Precio Unitario: <p th:text="'$'+${costo2}"></p>
						</div>
						<div class="is">Subtotal (sin iva): <p th:text="'$'+${costo}"></p>
						</div>
						<div class="is">Total: <p th:text="'$'+${costo3}"></p>
						</div>

					</div>
					<img th:src="@{/images/pasajero/img8.png}" width="150px" height="120px">
					<br>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="card" style="max-width: 450px;">
					<div class="card-body">
						<h5 class="card-title">MÉTODO DE PAGO:</h5>
						<h5 class="card-title">* RESERVA EN EFECTIVO:</h5>
							<div th:each="dato: ${datos}">
							<form id="formReserva" th:action="@{'/asientos/guardarReserva/' + ${dato[6]}+'/'+${costo3}}"
								method="post">
								<input type="hidden" id="idsAsientosSeleccionados" name="idsAsientosSeleccionados" />
								<div class="d-grid gap-2">
								<button type="submit" class="btn btn-primary" onclick="guardarAsientos()">
									Reserva en efectivo
								</button>
								</div>
								<p class="isa">Al reservar en efectivo debe cancelar el valor total en ventanilla una
									hora antes ,
									caso contrario se aplicará una multa.</p>
							</form>
						</div>
						<h5 class="card-title"> *RESERVA EN LÍNEA:</h5>
<div id="paypal-button-container"></div>
						
			
						
						<img th:src="@{/images/pasajero/img7.png}" width="150px" height="110px">
					</div>
				</div>
			</div>
		</div>
	</div>
<div class="m-3"></div>
	<div class="m-3"></div>
	<center>
		<div th:each="dato: ${datos}">
			<form th:action="@{'/asientos/cancelarReserva/' + ${dato[6]}}" method="post">

				<button type="submit" class="btn btn-danger">
					Cancelar reserva
				</button>
			</form>
		</div>
	</center>


	<footer th:replace="pasajero/layout :: footer"></footer>
	<script th:src="@{/js/pasajero/listarseleccion.js}"></script>
	
</body>

</html>